!function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof module&&module.exports?module.exports=factory(require("jquery")):factory(window.jQuery)}((function($){var JTableLanguage={"ko-KR":{borderColor:"선색",merge:{merge:"셀 병합",colspan:"가로",rowspan:"세로",split:"셀 병합 해제"},align:{top:"위쪽 정렬",middle:"가운데 정렬",bottom:"아래쪽 정렬",baseline:"기본 정렬"},addDeleteRowCOl:"행/열(추가/삭제)",areaReset:"넓이/높이 초기화",message:"<b>현재 또는 주위 셀<br/>병합 해제 후 사용 가능</b>"},"en-US":{borderColor:"Line Color",merge:{merge:"Cell Merge",colspan:"colspan",rowspan:"rowspan",split:"Reverse Cell Merge"},align:{top:"Align Top",middle:"Align Middle",bottom:"Align Bottom",baseline:"baseline"},addDeleteRowCOl:"Row/Col(Add/Del)",areaReset:"Width/Height Reset",message:"<b>Available after unmerge<br/>current or surrounding cells</b>"},"ja-JP":{borderColor:"線の色",merge:{merge:"セルの結合",colspan:"colspan",rowspan:"rowspan",split:"セルの分割"},align:{top:"上揃え",middle:"上下中央揃え",bottom:"下揃え",baseline:"baseline"},addDeleteRowCOl:"行/列(挿入/削除)",areaReset:"幅/高さ Reset",message:"<b>Available after unmerge<br/>current or surrounding cells</b>"},"zh-CN":{borderColor:"线条颜色",merge:{merge:"合并单元格",colspan:"colspan",rowspan:"rowspan",split:"拆分单元格"},align:{top:"顶端对齐",middle:"垂直居中",bottom:"底端对齐",baseline:"baseline"},addDeleteRowCOl:"行/列(揷入/删除)",areaReset:"宽/高 Reset",message:"<b>Available after unmerge<br/>current or surrounding cells</b>"},"zh-TW":{borderColor:"线条颜色",merge:{merge:"合併單元格",colspan:"colspan",rowspan:"rowspan",split:"拆分單元格"},align:{top:"顶端对齐",middle:"垂直居中",bottom:"底端对齐",baseline:"baseline"},addDeleteRowCOl:"行/列(揷入/删除)",areaReset:"寬/高 Reset",message:"<b>Available after unmerge<br/>current or surrounding cells</b>"}},TableResultAction=function(startPoint,where,action,domTable){const _startPoint={colPos:0,rowPos:0},_virtualTable=[],_actionCellList=[],_matrixTable=[];function setVirtualTablePosition(rowIndex,cellIndex,baseRow,baseCell,isRowSpan,isColSpan,isVirtualCell){const objPosition={baseRow:baseRow,baseCell:baseCell,isRowSpan:isRowSpan,isColSpan:isColSpan,isVirtual:isVirtualCell};_virtualTable[rowIndex]||(_virtualTable[rowIndex]=[]),_virtualTable[rowIndex][cellIndex]=objPosition}function getActionCell(virtualTableCellObj,resultAction,virtualRowPosition,virtualColPosition){return{baseCell:virtualTableCellObj.baseCell,action:resultAction,virtualTable:{rowIndex:virtualRowPosition,cellIndex:virtualColPosition}}}function recoverCellIndex(_table,rowIndex,cellIndex){if(!_table[rowIndex])return cellIndex;if(!_table[rowIndex][cellIndex])return cellIndex;let newCellIndex=cellIndex;for(;_table[rowIndex][newCellIndex];)if(newCellIndex++,!_table[rowIndex][newCellIndex])return newCellIndex}function addCellInfoToVirtual(row,cell){const cellIndex=recoverCellIndex(_virtualTable,row.rowIndex,cell.cellIndex),cellHasColspan=cell.colSpan>1,cellHasRowspan=cell.rowSpan>1,isThisSelectedCell=row.rowIndex===_startPoint.rowPos&&cell.cellIndex===_startPoint.colPos;setVirtualTablePosition(row.rowIndex,cellIndex,row,cell,cellHasRowspan,cellHasColspan,!1);const rowspanNumber=cell.attributes.rowSpan?parseInt(cell.attributes.rowSpan.value,10):0;if(rowspanNumber>1)for(let rp=1;rp<rowspanNumber;rp++){const rowspanIndex=row.rowIndex+rp;adjustStartPoint(rowspanIndex,cellIndex,cell,isThisSelectedCell),setVirtualTablePosition(rowspanIndex,cellIndex,row,cell,!0,cellHasColspan,!0)}const colspanNumber=cell.attributes.colSpan?parseInt(cell.attributes.colSpan.value,10):0;if(colspanNumber>1)for(let cp=1;cp<colspanNumber;cp++){const cellspanIndex=recoverCellIndex(_virtualTable,row.rowIndex,cellIndex+cp);adjustStartPoint(row.rowIndex,cellspanIndex,cell,isThisSelectedCell),setVirtualTablePosition(row.rowIndex,cellspanIndex,row,cell,cellHasRowspan,!0,!0)}}function adjustStartPoint(rowIndex,cellIndex,cell,isSelectedCell){rowIndex===_startPoint.rowPos&&_startPoint.colPos>=cell.cellIndex&&cell.cellIndex<=cellIndex&&!isSelectedCell&&_startPoint.colPos++}function getDeleteResultActionToCell(cell){switch(where){case TableResultAction.where.Column:if(cell.isColSpan)return TableResultAction.resultAction.SubtractSpanCount;break;case TableResultAction.where.Row:if(!cell.isVirtual&&cell.isRowSpan)return TableResultAction.resultAction.AddCell;if(cell.isRowSpan)return TableResultAction.resultAction.SubtractSpanCount}return TableResultAction.resultAction.RemoveCell}function getAddResultActionToCell(cell){switch(where){case TableResultAction.where.Column:if(cell.isColSpan)return TableResultAction.resultAction.SumSpanCount;if(cell.isRowSpan&&cell.isVirtual)return TableResultAction.resultAction.Ignore;break;case TableResultAction.where.Row:if(cell.isRowSpan)return TableResultAction.resultAction.SumSpanCount;if(cell.isColSpan&&cell.isVirtual)return TableResultAction.resultAction.Ignore}return TableResultAction.resultAction.AddCell}function setMatrixTable(rowIndex,cellIndex,baseRow,baseCell,isRowSpan,isColSpan,isVirtualCell){const objPosition={baseRow:baseRow,baseCell:baseCell,isRowSpan:isRowSpan,isColSpan:isColSpan,isVirtual:isVirtualCell};_matrixTable[rowIndex]||(_matrixTable[rowIndex]=[]),_matrixTable[rowIndex][cellIndex]=objPosition}function addCellInfoToMatrix(row,cell){const rowIndex=row.rowIndex,cellIndex=recoverCellIndex(_matrixTable,row.rowIndex,cell.cellIndex),cellHasRowspan=cell.rowSpan>1,cellHasColspan=cell.colSpan>1;setMatrixTable(rowIndex,cellIndex,row,cell,cellHasRowspan,cellHasColspan,!1);const rowspanNumber=cell.rowSpan,colspanNumber=cell.colSpan;if(cellHasColspan)for(let colCount=1;colCount<colspanNumber;colCount++)setMatrixTable(rowIndex,cellIndex+colCount,row,cell,cellHasRowspan,cellHasColspan,!0);if(cellHasRowspan)for(let rowCount=1;rowCount<rowspanNumber;rowCount++)if(setMatrixTable(rowIndex+rowCount,cellIndex,row,cell,cellHasRowspan,cellHasColspan,!0),cellHasColspan)for(let colCount=1;colCount<colspanNumber;colCount++)setMatrixTable(rowIndex+rowCount,cellIndex+colCount,row,cell,cellHasRowspan,cellHasColspan,!0)}this.getActionList=function(){const fixedRow=where===TableResultAction.where.Row?_startPoint.rowPos:-1,fixedCol=where===TableResultAction.where.Column?_startPoint.colPos:-1;let actualPosition=0,canContinue=!0;for(;canContinue;){const rowPosition=fixedRow>=0?fixedRow:actualPosition,colPosition=fixedCol>=0?fixedCol:actualPosition,row=_virtualTable[rowPosition];if(!row)return canContinue=!1,_actionCellList;const cell=row[colPosition];if(!cell)return canContinue=!1,_actionCellList;let resultAction=TableResultAction.resultAction.Ignore;switch(action){case TableResultAction.requestAction.Add:resultAction=getAddResultActionToCell(cell);break;case TableResultAction.requestAction.Delete:resultAction=getDeleteResultActionToCell(cell)}_actionCellList.push(getActionCell(cell,resultAction,rowPosition,colPosition)),actualPosition++}return _actionCellList},this.getVirtualTable=function(){return _virtualTable},this.getMatrixTable=function(){return _matrixTable},this.getColCount=function(){let columnCount=0;for(let i=0;i<_matrixTable.length;i++){let row=_matrixTable[i];columnCount<=row.length&&(columnCount=row.length)}return columnCount},startPoint&&startPoint.tagName&&("td"===startPoint.tagName.toLowerCase()||"th"===startPoint.tagName.toLowerCase())&&(_startPoint.colPos=startPoint.cellIndex,startPoint.parentElement&&startPoint.parentElement.tagName&&"tr"===startPoint.parentElement.tagName.toLowerCase()&&(_startPoint.rowPos=startPoint.parentElement.rowIndex)),function(){const rows=domTable.rows;for(let rowIndex=0;rowIndex<rows.length;rowIndex++){const cells=rows[rowIndex].cells;for(let cellIndex=0;cellIndex<cells.length;cellIndex++)addCellInfoToVirtual(rows[rowIndex],cells[cellIndex])}}(),function(){const rows=domTable.rows;for(let rowIndex=0;rowIndex<rows.length;rowIndex++){const cells=rows[rowIndex].cells;for(let cellIndex=0;cellIndex<cells.length;cellIndex++)addCellInfoToMatrix(rows[rowIndex],cells[cellIndex])}}()};TableResultAction.where={Row:0,Column:1},TableResultAction.requestAction={Add:0,Delete:1},TableResultAction.resultAction={Ignore:0,SubtractSpanCount:1,RemoveCell:2,AddCell:3,SumSpanCount:4},$.extend(!0,$.summernote,{plugins:{jTable:function(context){var self=this,dom=$.summernote.dom,ui=$.summernote.ui,options=context.options,modules=context.modules,lang=options.langInfo;lang.jTable=JTableLanguage[options.lang];var m_pTableResize={pressed:!1,rightFlag:!1,bottomFlag:!1,currentTableEl:null,currentTrEl:null,currentTdEl:null,currentTdLeft:null,currentTdRight:null,currentTdTop:null,currentTdBottom:null,startX:null,arrCurrentColTdEls:null,arrStartWidth:null,startY:null,startHeight:null,contenteditable:!1},m_pTableBlock={pressed:!1,currentTableEl:null,currentTdEl:null,currentLeftTopEl:null,currentTdLeft:null,currentTdRight:null,currentTdTop:null,currentTdBottom:null,currentTdPosition:{row:null,col:null},width:null,height:null,top:null,left:null,effect:{row:{start:null,end:null},col:{start:null,end:null}}};self.BTN_STATUS_HIDE=0,self.BTN_STATUS_MERGE=1,self.BTN_STATUS_SPLIT=2,self.m_pMergerdTd=null,self.m_bTableFocused=!1,self.m_pSelectBlockDiv=null,self.m_pTableBtn=null,self.m_nDefaultCellWidth=60,self.m_nDefaultCellHeight=40,self.m_pCellMergeBtn=null,self.m_pCellSplitBtn=null,self.initialize=function(){},self.destroy=function(){self.m_pCellMergeBtn&&($(self.m_pCellMergeBtn).remove(),self.m_pCellMergeBtn=null),self.m_pCellSplitBtn&&($(self.m_pCellSplitBtn).remove(),self.m_pCellSplitBtn=null),self.m_pMergerdTd&&($(self.m_pMergerdTd).remove(),self.m_pMergerdTd=null),self.m_pTableBtn&&($(self.m_pTableBtn).remove(),self.m_pTableBtn=null),self.m_pSelectBlockDiv&&($(self.m_pSelectBlockDiv).remove(),self.m_pSelectBlockDiv=null)},self.beforeCommand=function(){modules.editor.beforeCommand.call(modules.editor)},self.afterCommand=function(){modules.editor.afterCommand.call(modules.editor)},self.jAddRow=function(position){var rng=modules.editor.getLastRange.call(modules.editor);if(rng.isCollapsed()&&rng.isOnCell()){self.beforeCommand();for(var cell=dom.ancestor(rng.commonAncestor(),dom.isCell),currentTr=$(cell).closest("tr"),trAttributes=self.recoverAttributes(currentTr),html=$("<tr"+trAttributes+"></tr>"),actions=new TableResultAction(cell,TableResultAction.where.Row,TableResultAction.requestAction.Add,$(currentTr).closest("table")[0]).getActionList(),idCell=0;idCell<actions.length;idCell++){var currentCell=actions[idCell],tdAttributes=self.recoverAttributes(currentCell.baseCell);switch(currentCell.action){case TableResultAction.resultAction.AddCell:if("top"===position){var bottomColor=$(currentCell.baseCell).css("border-bottom-color");html.append("<td"+tdAttributes+">"+dom.blank+"</td>"),$(currentCell.baseCell).css("border-top-color",bottomColor)}else{var topColor=$(currentCell.baseCell).css("border-top-color");html.append("<td"+tdAttributes+">"+dom.blank+"</td>"),$(currentCell.baseCell).css("border-bottom-color",topColor)}break;case TableResultAction.resultAction.SumSpanCount:if("top"===position)if((currentCell.baseCell.parent?currentCell.baseCell.closest("tr").rowIndex:0)<=currentTr[0].rowIndex){var newTd=$("<div></div>").append($("<td"+tdAttributes+">"+dom.blank+"</td>").removeAttr("rowspan")).html();html.append(newTd);break}var rowspanNumber=parseInt(currentCell.baseCell.rowSpan,10);rowspanNumber++,currentCell.baseCell.setAttribute("rowSpan",rowspanNumber)}}if("top"===position)currentTr.before(html);else{if(cell.rowSpan>1){var lastTrIndex=currentTr[0].rowIndex+(cell.rowSpan-2);return void $($(currentTr).parent().find("tr")[lastTrIndex]).after($(html))}currentTr.after(html)}self.afterCommand()}self.HideSelectBlock()},self.jAddCol=function(position){var rng=modules.editor.getLastRange.call(modules.editor);if(rng.isCollapsed()&&rng.isOnCell()){self.beforeCommand();for(var cell=dom.ancestor(rng.commonAncestor(),dom.isCell),row=$(cell).closest("tr"),actions=new TableResultAction(cell,TableResultAction.where.Column,TableResultAction.requestAction.Add,$(row).closest("table")[0]).getActionList(),actionIndex=0;actionIndex<actions.length;actionIndex++){var currentCell=actions[actionIndex],tdAttributes=self.recoverAttributes(currentCell.baseCell);switch(currentCell.action){case TableResultAction.resultAction.AddCell:var $newTd=$("<td"+tdAttributes+">"+dom.blank+"</td>");"right"===position?($newTd.css("border-left-color",$(currentCell.baseCell).css("border-right-color")),$(currentCell.baseCell).after($newTd)):($newTd.css("border-right-color",$(currentCell.baseCell).css("border-left-color")),$(currentCell.baseCell).before($newTd));break;case TableResultAction.resultAction.SumSpanCount:var colspanNumber=parseInt(currentCell.baseCell.colSpan,10);colspanNumber++,currentCell.baseCell.setAttribute("colSpan",colspanNumber)}}self.afterCommand()}self.HideSelectBlock()},self.jDeleteRow=function(){var rng=modules.editor.getLastRange.call(modules.editor);if(rng.isCollapsed()&&rng.isOnCell()){self.beforeCommand();for(var cell=dom.ancestor(rng.commonAncestor(),dom.isCell),row=$(cell).closest("tr"),cellPos=row.children("td, th").index($(cell)),rowPos=row[0].rowIndex,actions=new TableResultAction(cell,TableResultAction.where.Row,TableResultAction.requestAction.Delete,$(row).closest("table")[0]).getActionList(),actionIndex=0;actionIndex<actions.length;actionIndex++)if(actions[actionIndex]){var baseCell=actions[actionIndex].baseCell,virtualPosition=actions[actionIndex].virtualTable,hasRowspan=baseCell.rowSpan&&baseCell.rowSpan>1,rowspanNumber=hasRowspan?parseInt(baseCell.rowSpan,10):0;switch(actions[actionIndex].action){case TableResultAction.resultAction.Ignore:continue;case TableResultAction.resultAction.AddCell:var nextRow=row.next("tr")[0];if(!nextRow)continue;var cloneRow=row[0].cells[cellPos];hasRowspan&&(rowspanNumber>2?(rowspanNumber--,nextRow.insertBefore(cloneRow,nextRow.cells[cellPos]),nextRow.cells[cellPos].setAttribute("rowSpan",rowspanNumber),nextRow.cells[cellPos].innerHTML=""):2===rowspanNumber&&(nextRow.insertBefore(cloneRow,nextRow.cells[cellPos]),nextRow.cells[cellPos].removeAttribute("rowSpan"),nextRow.cells[cellPos].innerHTML=""));continue;case TableResultAction.resultAction.SubtractSpanCount:hasRowspan&&(rowspanNumber>2?(rowspanNumber--,baseCell.setAttribute("rowSpan",rowspanNumber),virtualPosition.rowIndex!==rowPos&&baseCell.cellIndex===cellPos&&(baseCell.innerHTML="")):2===rowspanNumber&&(baseCell.removeAttribute("rowSpan"),virtualPosition.rowIndex!==rowPos&&baseCell.cellIndex===cellPos&&(baseCell.innerHTML="")));continue;case TableResultAction.resultAction.RemoveCell:continue}}row.remove(),self.afterCommand()}self.HideSelectBlock()},self.jDeleteCol=function(){var rng=modules.editor.getLastRange.call(modules.editor);if(rng.isCollapsed()&&rng.isOnCell()){self.beforeCommand();for(var cell=dom.ancestor(rng.commonAncestor(),dom.isCell),row=$(cell).closest("tr"),cellPos=row.children("td, th").index($(cell)),actions=new TableResultAction(cell,TableResultAction.where.Column,TableResultAction.requestAction.Delete,$(row).closest("table")[0]).getActionList(),actionIndex=0;actionIndex<actions.length;actionIndex++)if(actions[actionIndex])switch(actions[actionIndex].action){case TableResultAction.resultAction.Ignore:continue;case TableResultAction.resultAction.SubtractSpanCount:var baseCell=actions[actionIndex].baseCell;if(baseCell.colSpan&&baseCell.colSpan>1){var colspanNumber=baseCell.colSpan?parseInt(baseCell.colSpan,10):0;colspanNumber>2?(colspanNumber--,baseCell.setAttribute("colSpan",colspanNumber),baseCell.cellIndex===cellPos&&(baseCell.innerHTML="")):2===colspanNumber&&(baseCell.removeAttribute("colSpan"),baseCell.cellIndex===cellPos&&(baseCell.innerHTML=""))}continue;case TableResultAction.resultAction.RemoveCell:dom.remove(actions[actionIndex].baseCell,!0);continue}self.afterCommand()}self.HideSelectBlock()},self.recoverAttributes=function(el,bExcludeSpan){var resultStr="";if(!el)return resultStr;for(var attrList=el.attributes||[],i=0;i<attrList.length;i++){switch(attrList[i].name.toLowerCase()){case"id":continue;case"style":for(var styles=attrList[i].value.split(";"),styleStr="",j=0;j<styles.length;j++){var key=styles[j].split(":")[0].trim();"text-align"!=key&&"vertical-align"!=key&&(""!=styles[j].trim()&&(styleStr+=styles[j]+";"))}resultStr+=" "+attrList[i].name+"='"+styleStr+"'";break;case"colspan":case"rowspan":if(bExcludeSpan)continue;default:resultStr+=" "+attrList[i].name+"='"+attrList[i].value+"'"}}return resultStr},self.insertTable=function(dim){self.beforeCommand();var range=modules.editor.getLastRange();if(range.sc==range.ec){var dimension=dim.split("x"),rng=range.deleteContents(),tableDivEl=self.createTable(dimension[0],dimension[1],options);rng.insertNode(tableDivEl);var $btnTable=$(tableDivEl).closest(".note-editor").find(".note-table button");$(tableDivEl).find("td").each((function(idx,td){$(td).on("focus",(function(){self.tableFocused||($btnTable.attr("disabled","disabled"),$btnTable.addClass("disabled"),self.tableFocused=!0)}))})),$(tableDivEl).on("remove",(function(){$btnTable.removeAttr("disabled"),$btnTable.removeClass("disabled"),self.tableFocused=!1})),$(tableDivEl).find("td, th").css("border","1px solid black"),m_pTableBlock.currentTableEl=tableDivEl,self.afterCommand()}},self.createTable=function(colCount,rowCount,options){for(var tdHTML,tds=[],idxCol=0;idxCol<colCount;idxCol++)tds.push('<td style="width: '+self.m_nDefaultCellWidth+"px; height:"+self.m_nDefaultCellHeight+'px; padding:0px;">'+dom.blank+"</td>");tdHTML=tds.join("");for(var trHTML,trs=[],idxRow=0;idxRow<rowCount;idxRow++)trs.push("<tr>"+tdHTML+"</tr>");trHTML=trs.join("");var $table=$('<table style="width: auto; border-collapse:collapse; word-break:break-all">'+trHTML+"</table>");return options&&options.tableClassName&&$table.addClass(options.tableClassName),$table[0]},self.setStyleOnSelectedBlock=function(style,value){self.beforeCommand();for(var matrixTable=new TableResultAction(m_pTableBlock.currentLeftTopEl,null,null,m_pTableBlock.currentTableEl).getMatrixTable(),effectRow=m_pTableBlock.effect.row,effectCol=m_pTableBlock.effect.col,rowIndex=effectRow.start;rowIndex<=effectRow.end;rowIndex++)if(matrixTable[rowIndex])for(var colIndex=effectCol.start;colIndex<=effectCol.end;colIndex++)switch(style){case"borderColor":var topColor,rightColor,bottomColor,leftColor;if(Array.isArray(value)?(topColor=value[0],rightColor=value[1],bottomColor=value[2],leftColor=value[3]):(topColor=value,rightColor=value,bottomColor=value,leftColor=value),(virtualTd=matrixTable[rowIndex][colIndex])&&virtualTd.baseCell&&!virtualTd.isVirtual){Array.isArray(value)?$(virtualTd.baseCell).css("border-color",topColor+" "+rightColor+" "+bottomColor+" "+leftColor):$(virtualTd.baseCell).css("border-color",value);for(var nRowSpan=virtualTd.baseCell.rowSpan,nColSpan=virtualTd.baseCell.colSpan,i=0;i<nRowSpan;i++)for(var j=0;j<nColSpan;j++){if(matrixTable[rowIndex-1+i]){var virtualTopTd=matrixTable[rowIndex-1+i][colIndex+j];virtualTopTd&&virtualTopTd.baseCell&&virtualTopTd.baseCell!=virtualTd.baseCell&&$(virtualTopTd.baseCell).css("border-bottom-color",topColor)}if(matrixTable[rowIndex+1+i]){var virtualBottomTd=matrixTable[rowIndex+1+i][colIndex+j];virtualBottomTd&&virtualBottomTd.baseCell&&virtualBottomTd.baseCell!=virtualTd.baseCell&&$(virtualBottomTd.baseCell).css("border-top-color",bottomColor)}if(matrixTable[rowIndex+i]){var virtualLeftTd=matrixTable[rowIndex+i][colIndex-1+j];virtualLeftTd&&virtualLeftTd.baseCell&&virtualLeftTd.baseCell!=virtualTd.baseCell&&$(virtualLeftTd.baseCell).css("border-right-color",leftColor);var virtualRightTd=matrixTable[rowIndex+i][colIndex+1+j];virtualRightTd&&virtualRightTd.baseCell&&virtualRightTd.baseCell!=virtualTd.baseCell&&$(virtualRightTd.baseCell).css("border-left-color",rightColor)}}}break;case"background-color":case"text-align":case"vertical-align":var virtualTd;(virtualTd=matrixTable[rowIndex][colIndex])&&virtualTd.baseCell&&!virtualTd.isVirtual&&$(virtualTd.baseCell).css(style,value)}self.resetTableBlock(),self.afterCommand()},self.setCellBorderColor=function(borderColor){self.setStyleOnSelectedBlock("borderColor",borderColor)},self.setCellBackgroundColor=function(backColor){self.setStyleOnSelectedBlock("background-color",backColor)},self.setCellHorizontalAlign=function(position){self.setStyleOnSelectedBlock("text-align",position)},self.setCellVerticalAlign=function(position){self.setStyleOnSelectedBlock("vertical-align",position)},self.colorPalette=function(className,tooltip,callbackFnc){var bBorderColor="note-color-table-border"==className;return ui.buttonGroup({className:"note-color "+className,children:[ui.button({className:"note-current-color-button",contents:ui.icon(options.icons.font+" note-recent-color"),tooltip:tooltip,container:options.container,click:function(e){var value,bBorderColor="note-color-table-border"==className,$button=$(e.currentTarget);"rgba(0, 0, 0, 0)"==(value=bBorderColor?$button.attr("data-borderColor"):$button.attr("data-backColor"))&&(value="transparent"),callbackFnc(value)},callback:function($button){const $recentColor=$button.find(".note-recent-color");$recentColor.css("background-color","note-color-table-border"==className?"black":"white"),$button.attr("data-backColor","note-color-table-border"==className?"black":"white"),$recentColor.css("color","transparent")}}),ui.button({className:"dropdown-toggle",contents:ui.dropdownButtonContents("",options),tooltip:lang.color.more,container:options.container,data:{toggle:"dropdown"}}),ui.dropdown({items:['<div class="note-palette">','<div class="note-palette-title">'+(bBorderColor?lang.jTable.borderColor:lang.color.background)+"</div>","<div>",'<button type="button" class="note-color-reset btn btn-light" data-event="'+(bBorderColor?"borderColor":"backColor")+'" data-value="transparent">',lang.color.transparent,"</button>","</div>",'<div class="note-holder" data-event="'+(bBorderColor?"borderColor":"backColor")+'"></div>',"<div>",'<button type="button" class="note-color-select btn btn-light" data-event="openPalette" data-value="'+(bBorderColor?"borderColorPicker":"backColorPicker")+'">',lang.color.cpSelect,"</button>",'<input type="color" id="'+(bBorderColor?"borderColorPicker":"backColorPicker")+'" class="note-btn note-color-select-btn" value="'+options.colorButton.backColor+'" data-event="'+(bBorderColor?"borderColorPalette":"backColorPalette")+'">',"</div>",'<div class="note-holder-custom" id="'+(bBorderColor?"borderColorPalette":"backColorPalette")+'" data-event="'+(bBorderColor?"borderColor":"backColor")+'"></div>',"</div>"].join(""),callback:function($dropdown){$dropdown.find(".note-holder").each((function(idx,item){const $holder=$(item);$holder.append(ui.palette({colors:options.colors,colorsName:options.colorsName,eventName:$holder.data("event"),container:options.container,tooltip:options.tooltip,container:options.container}).render())}));var customColors=[["#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"]];$dropdown.find(".note-holder-custom").each((function(idx,item){const $holder=$(item);$holder.append(ui.palette({colors:customColors,colorsName:customColors,eventName:$holder.data("event"),container:options.container,tooltip:options.tooltip,container:options.container}).render())})),$dropdown.find("input[type=color]").each((function(idx,item){$(item).change((function(){const $chip=$dropdown.find("#"+$(this).data("event")).find(".note-color-btn").first(),color=this.value.toUpperCase();$chip.css("background-color",color).attr("aria-label",color).attr("data-value",color).attr("data-title",color).attr("data-original-title",color);const $color=$chip.closest(".note-color").find(".note-recent-color"),$currentButton=$chip.closest(".note-color").find(".note-current-color-button");$color.css("background-color",color),$currentButton.attr("data-backColor",color),callbackFnc(color)}))}))},click:function(event){event.stopPropagation();const $parent=$(this).closest(".note-popover").find(".note-dropdown-menu"),$button=$(event.target),eventName=$button.data("event"),value=$button.attr("data-value");if("openPalette"===eventName){const $picker=$parent.find("#"+value),$palette=$($parent.find("#"+$picker.data("event")).find(".note-color-row")[0]),$chip=$palette.find(".note-color-btn").last().detach(),color=$picker.val();$chip.css("background-color",color).css("left",event.clientX).css("top",event.clientY).attr("aria-label",color).attr("data-value",color).attr("data-title",color).attr("data-original-title",color),$palette.prepend($chip),$picker.click()}else if("borderColorPalette"!==eventName&&"backColorPalette"!==eventName){const $color=$button.closest(".note-color").find(".note-recent-color"),$currentButton=$button.closest(".note-color").find(".note-current-color-button");$color.css("background-color",value),$currentButton.attr("data-"+eventName,value),callbackFnc(value)}}})]}).render()},self.OnDragCellMerge=function(){var cell=m_pTableBlock.currentLeftTopEl,table=m_pTableBlock.currentTableEl,matrixTable=new TableResultAction(cell,null,null,table).getMatrixTable(),nSelectStartRow=m_pTableBlock.effect.row.start,nSelectEndRow=m_pTableBlock.effect.row.end,nSelectStartCol=m_pTableBlock.effect.col.start,nSelectEndCol=m_pTableBlock.effect.col.end;if(nSelectStartRow==nSelectEndRow&&nSelectStartCol==nSelectEndCol)return self.resetTableBlock(),!0;for(var rowIndex=nSelectStartRow;rowIndex<=nSelectEndRow;rowIndex++)for(var colIndex=nSelectStartCol;colIndex<=nSelectEndCol;colIndex++){((virtualTd=matrixTable[rowIndex][colIndex]).isRowSpan||virtualTd.isColSpan)&&self.OnDivide(virtualTd.baseCell)}var $cell=$(cell),oldColor=[];oldColor.push($cell.css("border-top-color")),oldColor.push($cell.css("border-right-color")),oldColor.push($cell.css("border-bottom-color")),oldColor.push($cell.css("border-left-color"));var $tr=$cell.closest("tr"),tdList=matrixTable[$tr[0].rowIndex],tdIndex=0,countFlag=!1,effectCol=[];for(colIndex=0;colIndex<tdList.length;colIndex++){var virtualTd=tdList[colIndex];countFlag&&effectCol.push(virtualTd.baseCell),countFlag||cell!=virtualTd.baseCell?countFlag&&self.hasSpan(virtualTd.baseCell)&&(effectCol.pop(),countFlag=!1):(tdIndex=colIndex,countFlag=!0)}countFlag=!1;var effectRow=[];for(rowIndex=0;rowIndex<matrixTable.length;rowIndex++){virtualTd=matrixTable[rowIndex][tdIndex];countFlag&&effectRow.push(virtualTd.baseCell),countFlag||cell!=virtualTd.baseCell?countFlag&&self.hasSpan(virtualTd.baseCell)&&(effectRow.pop(),countFlag=!1):countFlag=!0}var newColSpan=parseInt(nSelectEndCol-nSelectStartCol+1,10),newRowSpan=parseInt(nSelectEndRow-nSelectStartRow+1,10),colRemoveCount=newColSpan-cell.colSpan,rowRemoveCount=newRowSpan-cell.rowSpan;tdList=$tr.find("td");for(var nWidth=0,nSpanCnt=0,i=0;i<tdList.length&&nSpanCnt!=newColSpan;i++)(nSpanCnt>0||tdList[i]==cell)&&(nWidth+=parseFloat($(tdList[i]).css("width")),nSpanCnt++);$cell.css("width",nWidth),$cell.prop("colspan",newColSpan);for(i=0;i<colRemoveCount;i++)$(effectCol[i]).remove();var trList=$(table).find("tr"),nHeight=0;nSpanCnt=0;for(i=0;i<trList.length&&nSpanCnt!=newRowSpan;i++)nSpanCnt>0&&(nHeight+=parseFloat($(trList[i]).css("height")),nSpanCnt++),$(trList[i]).find(cell).length&&(nHeight+=parseFloat($(trList[i]).css("height")),nSpanCnt++);$cell.css("height",nHeight),$cell.prop("rowspan",newRowSpan);for(i=0;i<rowRemoveCount;i++){var effectCell=effectRow[i];if(colRemoveCount>0)for(var j=0;j<colRemoveCount;j++)$(effectCell).next().remove();$(effectCell).parent().css("height",0),$(effectCell).remove()}self.setCellBorderColor(oldColor),self.resetTableBlock(),modules.tablePopover.hide()},self.OnDragCellSplit=function(){for(var matrixTable=new TableResultAction(m_pTableBlock.currentLeftTopEl,null,null,m_pTableBlock.currentTableEl).getMatrixTable(),effectRow=m_pTableBlock.effect.row,effectCol=m_pTableBlock.effect.col,rowIndex=effectRow.start;rowIndex<=effectRow.end;rowIndex++)if(matrixTable[rowIndex])for(var colIndex=effectCol.start;colIndex<=effectCol.end;colIndex++){var virtualTd=matrixTable[rowIndex][colIndex];virtualTd&&virtualTd.baseCell&&!virtualTd.isVirtual&&self.hasSpan(virtualTd.baseCell)&&self.OnDivide(virtualTd.baseCell)}},self.OnDivide=function(cell){var $cell=$(cell),$table=$cell.closest("table"),$tr=$cell.closest("tr"),currentColspan=parseInt(cell.colSpan,10),currentRowspan=parseInt(cell.rowSpan,10),insertColTdCount=currentColspan-1,startTrIndex=$tr[0].rowIndex,endTrIndex=startTrIndex+currentRowspan-1,oldColor=[];oldColor.push($cell.css("border-top-color")),oldColor.push($cell.css("border-right-color")),oldColor.push($cell.css("border-bottom-color")),oldColor.push($cell.css("border-left-color")),self.setCellBorderColor("black");for(var matrixTable=new TableResultAction(cell,null,null,$table[0]).getMatrixTable(),insertFlag=!1,nWidth=parseInt($cell.width()/currentColspan),nHeight=parseInt($cell.height()/currentRowspan),getNewCellElem=function(attributes){var $newCell=$("<td"+attributes+">"+dom.blank+"</td>");return $newCell.css("width",nWidth).css("height",nHeight).css("border","1px solid black").css("background-color","#FFFFFF"),$newCell[0]},rowIndex=startTrIndex;rowIndex<=endTrIndex;rowIndex++){for(var row=matrixTable[rowIndex],colIndex=0;colIndex<row.length;colIndex++){var baseCell=row[colIndex].baseCell;if(insertFlag&&cell!=row[colIndex].baseCell&&!row[colIndex].isVirtual){var tdAttributes=self.recoverAttributes(baseCell,!0);if($(baseCell).css("border-left-color","black"),rowIndex==startTrIndex)for(var i=0;i<insertColTdCount;i++)$(baseCell).before(getNewCellElem(tdAttributes));else for(i=0;i<currentColspan;i++)$(baseCell).before(getNewCellElem(tdAttributes));break}if(cell==baseCell&&(insertFlag=!0),insertFlag&&colIndex==row.length-1){tdAttributes=self.recoverAttributes(baseCell,!0);if(rowIndex==startTrIndex)for(i=0;i<insertColTdCount;i++)$(baseCell).after(getNewCellElem(tdAttributes));else{var $trList=$table.find("tr");if(baseCell=$($trList[rowIndex]).children().last()[0]){$(baseCell).css("border-right-color","black");for(i=0;i<currentColspan;i++)$(baseCell).after(getNewCellElem(tdAttributes))}else{($tr=$($trList[rowIndex])).css("height","");for(var i=0;i<currentColspan;i++)$tr.append(getNewCellElem(tdAttributes))}}}}insertFlag=!1}$cell.prop("colspan",1).prop("rowspan",1),$cell.css("width",nWidth).css("height",nHeight),m_pTableBlock.currentTableEl=$table[0],m_pTableBlock.currentLeftTopEl=cell,m_pTableBlock.effect.row={start:startTrIndex,end:startTrIndex},m_pTableBlock.effect.col={start:cell.cellIndex,end:cell.cellIndex},self.setCellBorderColor(oldColor),self.HideSelectBlock()},self.OnResetWidthHeight=function(){var rng=modules.editor.getLastRange.call(modules.editor);if(rng.isCollapsed()&&rng.isOnCell()){self.beforeCommand();var cell=dom.ancestor(rng.commonAncestor(),dom.isCell),$table=$(cell).closest("table");$table.removeAttr("width"),$table.removeAttr("height"),$table.css("width","auto").css("height","");var $cell=$table.find("tr, td, th");$cell.removeAttr("width"),$cell.removeAttr("height"),$cell.css("width","").css("height",""),$table.find("td").css("width",self.m_nDefaultCellWidth).css("height",self.m_nDefaultCellHeight),self.afterCommand()}self.HideSelectBlock()},self.HideSelectBlock=function(){self.m_pSelectBlockDiv&&self.m_pSelectBlockDiv.is(":visible")&&(self.m_pSelectBlockDiv.hide(),self.SetDisableUnsupportedBtns(!1))},self.SetEnableTableBtn=function(bFocus){bFocus?(self.m_pTableBtn.attr("disabled","disabled"),self.m_pTableBtn.addClass("disabled")):(self.m_pTableBtn.removeAttr("disabled"),self.m_pTableBtn.removeClass("disabled")),self.m_bTableFocused=bFocus},self.SetDisableUnsupportedBtns=function(bSelected){var $toolbarBtns=modules.toolbar.$toolbar.find("button");bSelected?$toolbarBtns.attr("disabled","disabled"):$toolbarBtns.removeAttr("disabled");var $btnGroups=modules.tablePopover.$popover.find(".note-btn-group"),$pBtnAddDelRowCol=$btnGroups.siblings(".jtable-add-del-row-col"),$pBtnDelete=$btnGroups.siblings(".note-delete");bSelected?($pBtnAddDelRowCol.hide(),$pBtnDelete.hide()):($pBtnAddDelRowCol.show(),$pBtnDelete.show())},self.hasSpan=function(cell){return cell.rowSpan>1||cell.colSpan>1},self.setMergeBtn=function(status){switch(status){case self.BTN_STATUS_HIDE:$(self.m_pCellMergeBtn).hide(),$(self.m_pCellSplitBtn).hide();break;case self.BTN_STATUS_MERGE:$(self.m_pCellMergeBtn).show(),$(self.m_pCellSplitBtn).hide();break;case self.BTN_STATUS_SPLIT:$(self.m_pCellMergeBtn).hide(),$(self.m_pCellSplitBtn).show()}},self.resetTableResizeCursor=function($this,contenteditable){$this.closest(".note-editing-area").css("cursor","auto"),$this.closest(".note-editable").prop("contenteditable",contenteditable)},self.resetTableResize=function(){m_pTableResize={pressed:!1,rightFlag:!1,bottomFlag:!1,currentTableEl:null,currentTdEl:null,currentTdLeft:null,currentTdRight:null,currentTdTop:null,currentTdBottom:null,startX:null,arrCurrentColTdEls:null,arrStartWidth:null,startY:null,startHeight:null,contenteditable:!1}},self.resetTableBlock=function(){m_pTableBlock={pressed:!1,currentTableEl:null,currentTdEl:null,currentLeftTopEl:null,currentTdLeft:null,currentTdRight:null,currentTdTop:null,currentTdBottom:null,currentTdPosition:{row:null,col:null},width:null,height:null,top:null,left:null,effect:{row:{start:null,end:null},col:{start:null,end:null}}},self.HideSelectBlock(),self.setMergeBtn(self.BTN_STATUS_HIDE)},self.OnMouseMoveChangeCursor=function(event){var $this=$(this),$tr=$this.closest("tr"),targetRight=$this.offset().left+$this.outerWidth(),targetBottom=$tr.offset().top+$this.outerHeight(),rightFlag=!1;targetRight-5<=event.pageX&&(rightFlag=!0);var cursor,bottomFlag=!1;(targetBottom-5<=event.pageY&&(bottomFlag=!0),rightFlag||bottomFlag)?(cursor=rightFlag&&bottomFlag?"move":rightFlag?"col-resize":"row-resize",$this.closest(".note-editing-area").css("cursor",cursor)):$this.closest(".note-editing-area").css("cursor","auto")},self.OnResizeCell=function(event){var $this=$(this),targetLeft=m_pTableResize.currentTdLeft,targetTop=m_pTableResize.currentTdTop;if(m_pTableResize.rightFlag){if(!(targetLeft+1<=event.pageX))return self.resetTableResizeCursor($this,m_pTableResize.contenteditable),self.resetTableResize(),!0;for(var change=event.pageX-m_pTableResize.startX,i=0;i<m_pTableResize.arrCurrentColTdEls.length;i++){var td=m_pTableResize.arrCurrentColTdEls[i];$(td).css("width",m_pTableResize.arrStartWidth[i]+change)}}if(m_pTableResize.bottomFlag){if(!(targetTop+1<=event.pageY))return self.resetTableResizeCursor($this,m_pTableResize.contenteditable),self.resetTableResize(),!0;var $tr=$(m_pTableResize.currentTrEl),height=m_pTableResize.startHeight+(event.pageY-m_pTableResize.startY);if($tr.children().length)$(m_pTableResize.currentTrEl).children().css("height",height);else{for(;!$tr.children().length;)$tr=$tr.prev();$tr.children().css("height",height)}}},self.OnSelectBlock=function(event,$this){if(modules.tablePopover.hide(),$this.length||($this=$(event.target).closest("th")),$this.length){getSelection().removeAllRanges();var $table=$this.closest("table"),cellPosition=self.getCellPosition($this[0],$table[0]),colPos=m_pTableBlock.effect.col,rowPos=m_pTableBlock.effect.row,lowCol=0,lowRow=0,highCol=0,highRow=0,curTdColSpan=m_pTableBlock.currentTdEl.colSpan-1,curTdRowSpan=m_pTableBlock.currentTdEl.rowSpan-1,targetTdColSpan=event.target.colSpan-1,targetTdRowSpan=event.target.rowSpan-1,startTdColWidth=m_pTableBlock.currentTdPosition.col+curTdColSpan,startTdRowHeight=m_pTableBlock.currentTdPosition.row+curTdRowSpan,targetTdColWidth=cellPosition.col+targetTdColSpan,targetTdRowHeight=cellPosition.row+targetTdRowSpan;startTdColWidth>targetTdColWidth?(lowCol=targetTdColWidth,highCol=startTdColWidth):startTdColWidth==targetTdColWidth?m_pTableBlock.currentTdPosition.col>cellPosition.col?(lowCol=cellPosition.col,highCol=m_pTableBlock.currentTdPosition.col):(lowCol=m_pTableBlock.currentTdPosition.col,highCol=cellPosition.col):(lowCol=startTdColWidth,highCol=targetTdColWidth),startTdRowHeight>targetTdRowHeight?(lowRow=targetTdRowHeight,highRow=startTdRowHeight):startTdRowHeight==targetTdRowHeight?m_pTableBlock.currentTdPosition.row>cellPosition.row?(lowRow=cellPosition.row,highRow=m_pTableBlock.currentTdPosition.row):(lowRow=m_pTableBlock.currentTdPosition.row,highRow=cellPosition.row):(lowRow=startTdRowHeight,highRow=targetTdRowHeight);for(var matrixTable=new TableResultAction(m_pTableBlock.currentLeftTopEl,null,null,$table[0]).getMatrixTable(),minLeft=m_pTableBlock.currentTdLeft,minTop=m_pTableBlock.currentTdTop,maxBlockWidth=m_pTableBlock.currentTdRight-m_pTableBlock.currentTdLeft,maxBlockHeight=m_pTableBlock.currentTdBottom-m_pTableBlock.currentTdTop,rowIndex=lowRow;rowIndex<=highRow;rowIndex++)if(matrixTable[rowIndex])for(var colIndex=lowCol;colIndex<=highCol;colIndex++){var cell=matrixTable[rowIndex][colIndex];if(cell){var $cell=$(cell.baseCell);targetTdColSpan=cell.baseCell.colSpan-1,targetTdRowSpan=cell.baseCell.rowSpan-1;var targetTop=$cell.offset().top,targetLeft=$cell.offset().left,targetRight=targetLeft+$cell.outerWidth(),targetBottom=targetTop+$cell.outerHeight();if(targetLeft<minLeft)minLeft=targetLeft,cell.isVirtual?colPos.start=colIndex-targetTdColSpan:colPos.start=colIndex;else{var tmpWidth=targetRight-minLeft;tmpWidth>maxBlockWidth&&(maxBlockWidth=tmpWidth,colPos.end=colIndex+targetTdColSpan)}if(targetTop<minTop)minTop=targetTop,cell.isVirtual?rowPos.start=rowIndex-targetTdRowSpan:rowPos.start=rowIndex;else{var tmpHeight=targetBottom-minTop;tmpHeight>maxBlockHeight&&(maxBlockHeight=tmpHeight,rowPos.end=rowIndex+targetTdRowSpan)}}}m_pTableBlock.left=minLeft,m_pTableBlock.width=maxBlockWidth,m_pTableBlock.top=minTop,m_pTableBlock.height=maxBlockHeight,m_pTableBlock.currentLeftTopEl=matrixTable[lowRow][lowCol].baseCell,self.m_pSelectBlockDiv.show(),self.m_pSelectBlockDiv.offset({left:m_pTableBlock.left,top:m_pTableBlock.top}),self.m_pSelectBlockDiv.css({width:m_pTableBlock.width,height:m_pTableBlock.height})}},self.getCellPosition=function(cellEl,tableEl){for(var matrixTable=new TableResultAction(cellEl,null,null,tableEl).getMatrixTable(),rowIndex=0;rowIndex<matrixTable.length;rowIndex++)for(var matrixTr=matrixTable[rowIndex],colIndex=0;colIndex<matrixTr.length;colIndex++){if(matrixTable[rowIndex][colIndex].baseCell==cellEl)return{row:rowIndex,col:colIndex}}},self.OnMouseDownChangeCursor=function(event){if(self.m_bTableFocused){var $this=$(this),$table=$this.closest("table"),$tr=$this.closest("tr"),rowSpan=this.rowSpan;if(rowSpan&&rowSpan>1)for(var i=0;i<rowSpan-1;i++)$tr=$tr.next();var targetLeft=$this.offset().left,targetRight=targetLeft+$this.outerWidth(),targetTop=$this.offset().top,targetBottom=targetTop+$this.outerHeight(),rightFlag=!1;targetRight-5<=event.pageX&&(rightFlag=!0);var bottomFlag=!1;targetBottom-5<=event.pageY&&(bottomFlag=!0);var cursor,contenteditable=$this.closest(".note-editable").prop("contenteditable");if(!rightFlag&&!bottomFlag)return self.resetTableResizeCursor($this,contenteditable),void self.resetTableResize();modules.tablePopover.hide(),cursor=rightFlag&&bottomFlag?"move":rightFlag?"col-resize":"row-resize",$this.closest(".note-editing-area").css("cursor",cursor),$this.closest(".note-editable").removeAttr("contenteditable");for(var matrixTable=new TableResultAction(this,null,null,$table[0]).getMatrixTable(),trIndex=$tr[0].rowIndex,cellHasColspan=this.colSpan>1,tdList=matrixTable[trIndex],colIndex=0;colIndex<tdList.length;colIndex++){if(this==tdList[colIndex].baseCell)break}cellHasColspan&&(colIndex+=this.colSpan-1);for(var arrCurrentColTdEls=[],arrStartWidth=[],rowIndex=0;rowIndex<matrixTable.length;rowIndex++){var td=matrixTable[rowIndex][colIndex];arrCurrentColTdEls.push(td.baseCell),arrStartWidth.push($(td.baseCell).width())}m_pTableResize={pressed:!0,rightFlag:rightFlag,bottomFlag:bottomFlag,currentTableEl:$table[0],currentTrEl:$tr[0],currentTdEl:this,currentTdLeft:targetLeft,currentTdRight:targetRight,currentTdTop:targetTop,currentTdBottom:targetBottom,startX:event.pageX,arrCurrentColTdEls:arrCurrentColTdEls,arrStartWidth:arrStartWidth,startY:event.pageY,startHeight:$tr.height(),contenteditable:contenteditable},self.resetTableBlock(),event.stopPropagation()}else self.SetEnableTableBtn(!0)},self.events={"summernote.init":function(_,layoutInfo){self.m_pTableBtn=layoutInfo.toolbar.find(".note-table button"),self.m_pSelectBlockDiv=$("<div class='jtable-block'></div>");var $mergeBtns=layoutInfo.editor.find(".note-popover .note-merge button");self.m_pCellMergeBtn=$mergeBtns.eq(0),self.m_pCellSplitBtn=$mergeBtns.eq(1),self.setMergeBtn(self.BTN_STATUS_HIDE),layoutInfo.editingArea.append(self.m_pSelectBlockDiv.get(0)),layoutInfo.editor.find(".note-delete").on("click",(function(event){self.HideSelectBlock()})),layoutInfo.editingArea.on("mousedown",".note-editable",(function(event){self.m_bTableFocused&&self.SetEnableTableBtn(!1),self.HideSelectBlock()})),layoutInfo.editable.on("keydown scroll",(function(event){self.HideSelectBlock()})),layoutInfo.editingArea.on("click",".note-editable table",(function(event){var $target=$(event.target).closest("td");$target.length||($target=$(event.target).closest("th")),$target.length&&modules.tablePopover.update($target[0])})),layoutInfo.editingArea.on("keyup",".note-editable",(function(event){var focusNode=window.getSelection().focusNode;$(focusNode).parents("td").length?self.m_bTableFocused||self.SetEnableTableBtn(!0):self.m_bTableFocused&&self.SetEnableTableBtn(!1)})),layoutInfo.editingArea.on("mouseout",".note-editable table",(function(event){$(this).closest(".note-editing-area").css("cursor","auto")})),layoutInfo.editingArea.on("mousedown","td",(function(event){if(m_pTableBlock.pressed)return!0;var $this=$(this);if(self.resetTableBlock(),m_pTableResize.pressed)return!0;self.hasSpan(this)?self.setMergeBtn(self.BTN_STATUS_SPLIT):self.setMergeBtn(self.BTN_STATUS_HIDE);var $table=$this.closest("table"),targetTop=$this.offset().top,targetLeft=$this.offset().left,targetWidth=$this.outerWidth(),targetHeight=$this.outerHeight(),targetRight=targetLeft+targetWidth,targetBottom=targetTop+targetHeight,cellPosition=self.getCellPosition(this,$table[0]);null==cellPosition&&((cellPosition={}).row=null,cellPosition.col=null),m_pTableBlock={pressed:!0,currentTableEl:$table[0],currentTdEl:this,currentLeftTopEl:this,currentTdLeft:targetLeft,currentTdRight:targetRight,currentTdTop:targetTop,currentTdBottom:targetBottom,currentTdPosition:{row:cellPosition.row,col:cellPosition.col},width:targetWidth,height:targetHeight,top:targetTop,left:targetLeft,effect:{row:{start:cellPosition.row,end:cellPosition.row+(this.rowSpan-1)},col:{start:cellPosition.col,end:cellPosition.col+(this.colSpan-1)}}};var borderColor=$(event.currentTarget).css("border-color"),backColor=$(event.currentTarget).css("background-color");if(borderColor){var $pBtnBorderColor=modules.tablePopover.$popover.find(".note-color-table-border");borderColor=$pBtnBorderColor.find(".note-current-color-button i").css("background-color"),$pBtnBorderColor.find(".note-current-color-button").attr("data-borderColor",borderColor)}if(backColor){var $pBtnBackColor=modules.tablePopover.$popover.find(".note-color-back");backColor=$pBtnBackColor.find(".note-recent-color i").css("background-color"),$pBtnBackColor.find(".note-current-color-button").attr("data-backColor",backColor)}event.stopPropagation()})),layoutInfo.editingArea.on("mousemove",".note-editable",(function(event){var $this=$(event.target).closest("td");return!m_pTableBlock.pressed||(m_pTableBlock.currentTdEl==$this[0]?(self.HideSelectBlock(),!0):(self.OnSelectBlock(event,$this),void event.preventDefault()))})),layoutInfo.editingArea.on("mousedown touchstart",".note-editable",(function(event){if(!m_pTableBlock.pressed)return!0;event.preventDefault()})),layoutInfo.editingArea.on("mouseup",".note-editable",(function(event){if(!m_pTableBlock.pressed)return!0;m_pTableBlock.pressed=!1;var bSelected=!1;self.m_pSelectBlockDiv&&self.m_pSelectBlockDiv.is(":visible")&&(bSelected=!0,self.SetDisableUnsupportedBtns(bSelected));var $cell=$(event.target).closest("td"),cell=$cell[0];if($cell.length||($cell=$(event.target).closest("th")),$cell.length){for(var $table=$cell.closest("table"),matrixTable=new TableResultAction(cell,null,null,$table[0]).getMatrixTable(),hasSpan=!1,effectRow=m_pTableBlock.effect.row,effectCol=m_pTableBlock.effect.col,cellCnt=0,rowIndex=effectRow.start;rowIndex<=effectRow.end;rowIndex++)if(matrixTable[rowIndex])for(var colIndex=effectCol.start;colIndex<=effectCol.end;colIndex++){var virtualTd=matrixTable[rowIndex][colIndex];virtualTd&&virtualTd.baseCell&&!virtualTd.isVirtual&&(cellCnt++,hasSpan||(hasSpan=self.hasSpan(virtualTd.baseCell)))}hasSpan&&1==cellCnt?self.setMergeBtn(self.BTN_STATUS_SPLIT):!hasSpan&&cellCnt>1&&bSelected?self.setMergeBtn(self.BTN_STATUS_MERGE):self.setMergeBtn(self.BTN_STATUS_HIDE),modules.tablePopover.update(cell)}})),layoutInfo.editingArea.on("mousemove","td",self.OnMouseMoveChangeCursor),layoutInfo.editingArea.on("mousedown","td",self.OnMouseDownChangeCursor),layoutInfo.editingArea.on("mousemove",".note-editable",(function(event){if(!m_pTableResize.pressed)return!0;self.OnResizeCell(event)})),layoutInfo.editingArea.on("mousemove mousedown touchstart",".note-editable",(function(event){if(!m_pTableResize.pressed)return!0;event.preventDefault()})),layoutInfo.editingArea.on("mouseup",".note-editable",(function(event){if(!m_pTableResize.pressed)return!0;self.resetTableResizeCursor($(this),m_pTableResize.contenteditable),self.resetTableResize()}))}},context.memo("button.jAddDeleteRowCol",(function(){return ui.buttonGroup({className:"jtable-add-del-row-col",children:[ui.button({className:"dropdown-toggle",contents:ui.dropdownButtonContents(ui.icon(options.icons.rowAbove),options),tooltip:lang.jTable.addDeleteRowCOl,container:options.container,data:{toggle:"dropdown"},click:function(event){var $parent=$(this).closest(".jtable-add-del-row-col"),$btns=$parent.find(".btn-md"),hasSpan=!1,rng=modules.editor.getLastRange.call(modules.editor);if(rng.isCollapsed()&&rng.isOnCell()){var cell=dom.ancestor(rng.commonAncestor(),dom.isCell);$(cell).closest("table").find("td").each((function(i,td){if(hasSpan=self.hasSpan(td))return self.m_pMergerdTd=td,!1}))}$btns.toggleClass("disabled",hasSpan),$btns.attr("disabled",hasSpan);var $btnGroup=$parent.find(".jtable-add-row-col-button-group, .jtable-del-row-col-button-group"),$message=$parent.find(".jtable-dropdown-message"),$dropdown=$parent.find(".jtable-add-del-row-col-dropdown");hasSpan?($btnGroup.hide(),$message.show(),$dropdown.css("width","auto")):($btnGroup.show(),$message.hide(),$dropdown.css("width",""))}}),ui.dropdown({className:"jtable-add-del-row-col-dropdown",children:[ui.button({className:"jtable-dropdown-message",contents:lang.jTable.message,container:options.container}),ui.buttonGroup({className:"jtable-add-row-col-button-group",children:[ui.button({className:"btn-md",contents:ui.icon(options.icons.rowAbove),tooltip:lang.table.addRowAbove,container:options.container,click:context.createInvokeHandler("jTable.jAddRow","top")}),ui.button({className:"btn-md",contents:ui.icon(options.icons.rowBelow),tooltip:lang.table.addRowBelow,container:options.container,click:context.createInvokeHandler("jTable.jAddRow","bottom")}),ui.button({className:"btn-md",contents:ui.icon(options.icons.colBefore),tooltip:lang.table.addColLeft,container:options.container,click:context.createInvokeHandler("jTable.jAddCol","left")}),ui.button({className:"btn-md",contents:ui.icon(options.icons.colAfter),tooltip:lang.table.addColRight,container:options.container,click:context.createInvokeHandler("jTable.jAddCol","right")})]}),ui.buttonGroup({className:"jtable-del-row-col-button-group",children:[ui.button({className:"btn-md",contents:ui.icon(options.icons.rowRemove),tooltip:lang.table.delRow,container:options.container,click:context.createInvokeHandler("jTable.jDeleteRow")}),ui.button({className:"btn-md",contents:ui.icon(options.icons.colRemove),tooltip:lang.table.delCol,container:options.container,click:context.createInvokeHandler("jTable.jDeleteCol")})]})]})]}).render()})),context.memo("button.jAlign",(function(){return ui.buttonGroup([ui.button({className:"dropdown-toggle",contents:ui.dropdownButtonContents(ui.icon(options.icons.alignLeft),options),tooltip:lang.paragraph.paragraph,container:options.container,data:{toggle:"dropdown"}}),ui.dropdown({className:"jtable-align-dropdown",children:[ui.buttonGroup({className:"jtable-horizontal-align-button-group",children:[ui.button({contents:ui.icon(options.icons.alignLeft),tooltip:lang.paragraph.left,container:options.container,click:context.createInvokeHandler("jTable.setCellHorizontalAlign","left")}),ui.button({contents:ui.icon(options.icons.alignCenter),tooltip:lang.paragraph.center,container:options.container,click:context.createInvokeHandler("jTable.setCellHorizontalAlign","center")}),ui.button({contents:ui.icon(options.icons.alignRight),tooltip:lang.paragraph.right,container:options.container,click:context.createInvokeHandler("jTable.setCellHorizontalAlign","right")})]}),ui.buttonGroup({className:"jtable-vertical-align-button-group",children:[ui.button({className:"jtable-vertical-align-btn-top",contents:ui.icon(options.icons.alignJustify),tooltip:lang.jTable.align.top,container:options.container,click:context.createInvokeHandler("jTable.setCellVerticalAlign","top")}),ui.button({className:"jtable-vertical-align-btn-middle",contents:ui.icon(options.icons.alignJustify),tooltip:lang.jTable.align.middle,container:options.container,click:context.createInvokeHandler("jTable.setCellVerticalAlign","middle")}),ui.button({className:"jtable-vertical-align-btn-bottom",contents:ui.icon(options.icons.alignJustify),tooltip:lang.jTable.align.bottom,container:options.container,click:context.createInvokeHandler("jTable.setCellVerticalAlign","bottom")})]})]})],{callback:function($node){}}).render()})),context.memo("button.jMerge",(function(event){return ui.buttonGroup({children:[ui.button({contents:ui.icon("note-icon-table-merge"),tooltip:lang.jTable.merge.merge,container:options.container,click:context.createInvokeHandler("jTable.OnDragCellMerge")}),ui.button({className:"note-btn-jtable-cell-split",contents:ui.icon("note-icon-table-cell-split"),tooltip:lang.jTable.merge.split,container:options.container,click:context.createInvokeHandler("jTable.OnDragCellSplit")})]}).render()})),context.memo("button.jWidthHeightReset",(function(){return ui.button({className:"btn-md",contents:ui.icon("note-icon-table-width-height-reset"),tooltip:lang.table.table+" "+lang.jTable.areaReset,container:options.container,click:context.createInvokeHandler("jTable.OnResetWidthHeight")}).render()})),context.memo("button.jBorderColor",(function(){return self.colorPalette("note-color-table-border",lang.jTable.borderColor,self.setCellBorderColor)})),context.memo("button.jBackcolor",(function(){return self.colorPalette("note-color-back",lang.color.background,self.setCellBackgroundColor)})),context.memo("button.jTable",(function(){return ui.buttonGroup([ui.button({className:"dropdown-toggle",contents:ui.dropdownButtonContents(ui.icon(options.icons.table),options),tooltip:lang.table.table,container:options.container,data:{toggle:"dropdown"}}),ui.dropdown({title:lang.table.table,className:"note-table",items:['<div class="note-dimension-picker">','<div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div>','<div class="note-dimension-picker-highlighted"></div>','<div class="note-dimension-picker-unhighlighted"></div>',"</div>",'<div class="note-dimension-display">1 x 1</div>'].join("")})],{callback:function($node){$node.find(".note-dimension-picker-mousecatcher").css({width:options.insertTableMaxSize.col+"em",height:options.insertTableMaxSize.row+"em"}).mousedown(context.createInvokeHandler("jTable.insertTable")).on("mousemove",modules.buttons.tableMoveHandler.bind(context))}}).render()}))}}})}));window['OZHtmlEditorVersion']='2022.02.25.100'; 
