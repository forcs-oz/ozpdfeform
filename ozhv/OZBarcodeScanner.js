var OZBarcodeScanner;(()=>{"use strict";var t={123:function(t,i,s){var e=this&&this.t||function(t,i,s,e){return new(s||(s=Promise))((function(n,h){function o(t){try{r(e.next(t))}catch(t){h(t)}}function c(t){try{r(e.throw(t))}catch(t){h(t)}}function r(t){var i;t.done?n(t.value):(i=t.value,i instanceof s?i:new s((function(t){t(i)}))).then(o,c)}r((e=e.apply(t,i||[])).next())}))};Object.defineProperty(i,"i",{value:!0}),i.h=void 0;const n=s(151);class h{constructor(t){this.o=0,this.l=0,this.u=new Image,this.v=!1,this.p=!1,this.m=null,this.M=()=>{null!==this.m&&clearTimeout(this.m),this.m=window.setTimeout((()=>{this.C(),this.m=null}),200)},this.O={audio:!1,video:{advanced:[{facingMode:"environment"}]}},this.A=t}setBarcodeType(t){const i=[];t==h.All?i.push(n.BarcodeFormat.CODE_39,n.BarcodeFormat.CODE_93,n.BarcodeFormat.CODE_128,n.BarcodeFormat.CODABAR,n.BarcodeFormat.ITF,n.BarcodeFormat.RSS_14,n.BarcodeFormat.UPC_A,n.BarcodeFormat.UPC_E,n.BarcodeFormat.EAN_8,n.BarcodeFormat.EAN_13,n.BarcodeFormat.QR_CODE,n.BarcodeFormat.DATA_MATRIX,n.BarcodeFormat.AZTEC,n.BarcodeFormat.PDF_417):(0!=(t&h.One_Dimensional)?i.push(n.BarcodeFormat.CODE_39,n.BarcodeFormat.CODE_93,n.BarcodeFormat.CODE_128,n.BarcodeFormat.CODABAR,n.BarcodeFormat.ITF,n.BarcodeFormat.RSS_14,n.BarcodeFormat.UPC_A,n.BarcodeFormat.UPC_E,n.BarcodeFormat.EAN_8,n.BarcodeFormat.EAN_13):(0!=(t&h.CODE39)&&i.push(n.BarcodeFormat.CODE_39),0!=(t&h.CODE93)&&i.push(n.BarcodeFormat.CODE_93),0!=(t&h.CODE128)&&i.push(n.BarcodeFormat.CODE_128),0!=(t&h.CODABAR)&&i.push(n.BarcodeFormat.CODABAR),0!=(t&h.ITF)&&i.push(n.BarcodeFormat.ITF),0!=(t&h.RSS14)&&i.push(n.BarcodeFormat.RSS_14),0!=(t&h.UPCA)&&i.push(n.BarcodeFormat.UPC_A),0!=(t&h.UPCE)&&i.push(n.BarcodeFormat.UPC_E),0!=(t&h.EAN8)&&i.push(n.BarcodeFormat.EAN_8),0!=(t&h.EAN13)&&i.push(n.BarcodeFormat.EAN_13)),0!=(t&h.Two_Dimensional)?i.push(n.BarcodeFormat.QR_CODE,n.BarcodeFormat.DATA_MATRIX,n.BarcodeFormat.AZTEC,n.BarcodeFormat.PDF_417):(0!=(t&h.QRCODE)&&i.push(n.BarcodeFormat.QR_CODE),0!=(t&h.DATAMATRIX)&&i.push(n.BarcodeFormat.DATA_MATRIX),0!=(t&h.AZTEC)&&i.push(n.BarcodeFormat.AZTEC),0!=(t&h.PDF417)&&i.push(n.BarcodeFormat.PDF_417)));const s=new Map;s.set(n.DecodeHintType.POSSIBLE_FORMATS,i),this.R=s}D(){return e(this,void 0,void 0,(function*(){var t;const i={exact:void 0},s={video:{deviceId:i,width:{ideal:1920}}};if(h.P)return i.exact=h.P,navigator.mediaDevices.getUserMedia(s);{let e=yield navigator.mediaDevices.enumerateDevices();if(0===e.length||0===e[0].label.length){try{const t=yield navigator.mediaDevices.getUserMedia(this.O);t&&t.getTracks().forEach((t=>t.stop()))}catch(t){console.warn("Failed to access camera permission")}e=yield navigator.mediaDevices.enumerateDevices()}const n=e.filter((t=>"videoinput"===t.kind));n.sort(((t,i)=>t.label.localeCompare(i.label,void 0,{S:"base"})));const o=n.filter((t=>/back|rear/i.test(t.label)));o.forEach((t=>{n.splice(n.indexOf(t),1)})),o.sort(((t,i)=>t.label.localeCompare(i.label,void 0,{S:"base"}))),n.forEach((t=>{o.push(t)}));for(let e of o)try{i.exact=e.deviceId;const n=yield navigator.mediaDevices.getUserMedia(s),o=n.getVideoTracks()[0].getCapabilities(),c=(null===(t=o.facingMode)||void 0===t?void 0:t[0])||"unknown",r=o.focusDistance,a="environment"===c,l=void 0===r||r.max>1;if(a&&l)return h.P=e.deviceId,n;n.getTracks().forEach((t=>t.stop()))}catch(t){console.warn("Failed to access camera :",e.label,t)}}return navigator.mediaDevices.getUserMedia(this.O)}))}F(){this.D().then((t=>{if(null!=t)if(this.I=t.getVideoTracks()[0],this.T.onloadedmetadata=t=>{this.T.paused&&this.T.play().catch((t=>{console.error(t)})),this.B||(this.B=document.createElement("canvas"));const i=this.B.getContext("2d");this.Z=new n.BrowserMultiFormatReader(this.R),this.u.onload=()=>{!this.v&&this.j&&(this.v=!0,this.Z.decodeFromImageElement(this.u).then((t=>{if(this.A){let i=t.getText();const s=t.getBarcodeFormat();s==n.BarcodeFormat.CODABAR&&(i.length>0&&!/^\d$/.test(i.charAt(0))&&(i=i.substring(1)),i.length>0&&!/^\d$/.test(i.charAt(i.length-1))&&(i=i.substring(0,i.length-1))),this.A(h.N.get(s),i),this.stopPreview(),this.Z=null}})).catch((t=>{if(!(null==t?void 0:t.toString().includes("No MultiFormat Readers were able to detect the code")))throw t})).finally((()=>{this.v=!1})))},this.j=setInterval((()=>{this.k(i)}),h.U)},"srcObject"in this.T)this.T.srcObject=t;else{const i=window.URL||window.webkitURL;this.T.src=i.createObjectURL(t)}})).catch((t=>{this.p||(this.p=!0,this.F())}))}k(t){const i=this.X();this.B.width=i.width,this.B.height=i.height,t.drawImage(this.T,i.x,i.y,i.width,i.height,0,0,this.B.width,this.B.height),this.u.src=this.B.toDataURL()}X(){const t=this.T.getBoundingClientRect();let i=.8,s=.5;const e=t.width/t.height;e>1?s=Math.min(1,s*e):i=Math.min(1,i/e);const n=new DOMRect(t.x+t.width*((1-i)/2),t.y+t.height*((1-s)/2),t.width*i,t.height*s);return this.$(t,n)}$(t,i){const s=t.width,e=t.height,n=this.T.videoWidth,h=this.T.videoHeight,o=s/e;let c=0,r=0,a=n,l=h;n/h>o?(a=h*o,c=(n-a)/2):(l=n/o,r=(h-l)/2);const d=(i.left-t.left)/s,u=(i.top-t.top)/e,v=(t.right-i.right)/s,p=(t.bottom-i.bottom)/e;return new DOMRect(c+a*d,r+l*u,a*(1-d-v),l*(1-u-p))}C(){if(!this._.parentElement)return;const t=this._.parentElement.getBoundingClientRect();this.o=Math.round(t.width),this.l=Math.round(t.height);const i=this._.style;i.width=this.o+"px",i.height=this.l+"px";const s=this.V.style;s.width=this.o+"px",s.height=this.l+"px"}AppendPreviewOn(t){if(this._)return;const i=t.getBoundingClientRect();this.o=Math.round(i.width),this.l=Math.round(i.height),this._=document.createElement("div"),this._.style.display="flex";const s=this._.style;s.width=this.o+"px",s.height=this.l+"px";const e=document.createElement("div"),n=e.style;n.border="none",n.overflow="hidden",n.margin="auto",n.width=this.o+"px",n.height=this.l+"px",this.V=e;const h=document.createElement("video");h.setAttribute("playsinline",""),h.style.objectFit="cover",h.style.width="100%",h.style.height="100%",this.T=h,t.append(this._),this._.appendChild(this.V),this.V.append(this.T),this.q=new ResizeObserver((()=>{this.M()})),this.q.observe(t)}startCapture(){this.stopPreview(),this.F()}stopCapture(){this.stopPreview()}stopPreview(){this.j&&(clearInterval(this.j),this.j=null,this.u.src="",this.u.onload=null),this.I&&(this.I.stop(),this.I=null),this.T&&("srcObject"in this.T?this.T.srcObject=null:this.T.src="",this.T.pause())}dispose(){this.stopPreview(),this._&&(this._.remove(),this._=null),this.q.disconnect(),this.q=null}}i.h=h,h.All=268374014,h.One_Dimensional=16777216,h.CODE39=1,h.CODE93=2,h.CODE128=4,h.CODABAR=8,h.ITF=16,h.RSS14=32,h.UPCA=128,h.UPCE=256,h.EAN8=512,h.EAN13=1024,h.Two_Dimensional=33554432,h.QRCODE=2048,h.DATAMATRIX=4096,h.AZTEC=8192,h.PDF417=16384,h.N=new Map([[n.BarcodeFormat.CODE_39,"CODE39"],[n.BarcodeFormat.CODE_93,"CODE93"],[n.BarcodeFormat.CODE_128,"CODE128"],[n.BarcodeFormat.CODABAR,"CODABAR"],[n.BarcodeFormat.ITF,"ITF"],[n.BarcodeFormat.RSS_14,"RSS14"],[n.BarcodeFormat.UPC_A,"UPCA"],[n.BarcodeFormat.UPC_E,"UPCE"],[n.BarcodeFormat.EAN_8,"EAN8"],[n.BarcodeFormat.EAN_13,"EAN13"],[n.BarcodeFormat.QR_CODE,"QRCODE"],[n.BarcodeFormat.DATA_MATRIX,"DATAMATRIX"],[n.BarcodeFormat.AZTEC,"AZTEC"],[n.BarcodeFormat.PDF_417,"PDF417"]]),h.U=100},398:(t,i,s)=>{const e=s(123);t.exports=e.h},151:t=>{t.exports=ZXing}},i={};var s=function s(e){var n=i[e];if(void 0!==n)return n.exports;var h=i[e]={exports:{}};return t[e].call(h.exports,h,h.exports,s),h.exports}(398);OZBarcodeScanner=s})();